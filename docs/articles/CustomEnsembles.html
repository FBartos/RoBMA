<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fitting custom meta-analytic ensembles • RoBMA</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Fitting custom meta-analytic ensembles">
<meta property="og:description" content="RoBMA">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">RoBMA</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/CustomEnsembles.html">Fitting custom meta-analytic ensembles</a>
    </li>
    <li>
      <a href="../articles/ReproducingBMA.html">Reproducing BMA</a>
    </li>
    <li>
      <a href="../articles/WarningsAndErrors.html">Common warnings and errors</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/FBartos/RoBMA/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="CustomEnsembles_files/accessible-code-block-0.0.1/empty-anchor.js"></script><link href="CustomEnsembles_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="CustomEnsembles_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Fitting custom meta-analytic ensembles</h1>
                        <h4 class="author">František Bartoš</h4>
            
            <h4 class="date">2021-01-18</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/FBartos/RoBMA/blob/master/vignettes/CustomEnsembles.Rmd"><code>vignettes/CustomEnsembles.Rmd</code></a></small>
      <div class="hidden name"><code>CustomEnsembles.Rmd</code></div>

    </div>

    
    
<p>By default, the <code><a href="../reference/RoBMA.html">RoBMA()</a></code> function specifies models as a combination of all supplied prior distributions (across null and alternative specification), with their prior model odds being equal to the product of prior distributions’ prior odds. This results in the 12 meta-analytic models using the default settings <span class="citation">(Maier et al., 2020)</span>. In <a href="ReproducingBMA.html">another vignette</a>, we illustrated that RoBMA can be also utilized for reproducing Bayesian Model-Averaged Meta-Analysis (BMA) <span class="citation">(Gronau et al., 2017)</span> and in a tutorial paper, we showed how to fit custom models in JASP <span class="citation">(Bartoš et al., 2020)</span>. However, the package was built in a way that it can be used as a framework for estimating even more customized meta-analytic model ensembles. Here, we are going to illustrate how to do exactly that.</p>
<p>Please keep in mind that all models should be justified by theory. Furthermore, the models should be tested to make sure that it can perform as intended, a priori to drawing inference from it. The following sections are only illustrating the functionality of the package.</p>
<div id="the-dataset" class="section level3">
<h3 class="hasAnchor">
<a href="#the-dataset" class="anchor"></a>The dataset</h3>
<p>To illustrate the custom model building procedure, we use data from the infamous <span class="citation">Bem (2011)</span> “Feeling the future” paper. We use a coding of the results as presented by the original author <span class="citation">(Bem et al., 2011)</span>. According to the original papers, participants showed statistically significant signs of precognition (predicting the future) in 8/9 experiments. However, there are many issues with the paper <span class="citation">(Rouder &amp; Morey, 2011; Schimmack, 2018; Wagenmakers et al., 2011)</span>, which are not important for this vignette.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Bem2011</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
  study <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span> <span class="st">"1"</span>,  <span class="st">"2"</span>,  <span class="st">"3"</span>,  <span class="st">"4"</span>,  <span class="st">"5"</span>,  <span class="st">"6"</span>,  <span class="st">"7"</span>,  <span class="st">"8"</span>,  <span class="st">"9"</span><span class="op">)</span>,
  t     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2.51</span>, <span class="fl">2.39</span>, <span class="fl">2.55</span>, <span class="fl">2.03</span>, <span class="fl">2.23</span>, <span class="fl">2.41</span>, <span class="fl">1.31</span>, <span class="fl">1.92</span>, <span class="fl">2.96</span><span class="op">)</span>,
  N     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span> <span class="fl">100</span>,  <span class="fl">150</span>,   <span class="fl">97</span>,   <span class="fl">99</span>,  <span class="fl">100</span>,  <span class="fl">150</span>,  <span class="fl">200</span>,  <span class="fl">100</span>,   <span class="fl">50</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
</div>
<div id="the-custom-ensemble" class="section level3">
<h3 class="hasAnchor">
<a href="#the-custom-ensemble" class="anchor"></a>The custom ensemble</h3>
<p>Consider the following scenarios as plaussible explanations for the data, and include those into the meta-analytic ensemble:</p>
<ol style="list-style-type: decimal">
<li>there is absolutely no precognition effect - a fixed effects model assuming the effect size to be zero (<span class="math inline">\(H_{0}^{\overline{\omega}f}\)</span>)</li>
<li>the experiments measured the same underlying precognition effect - a fixed effects model (<span class="math inline">\(H_{1}^{\overline{\omega}f}\)</span>)</li>
<li>each of the experiments measured a slightly different precognition effect - a random effects model (<span class="math inline">\(H_{1}^{\overline{\omega}r}\)</span>)</li>
<li>there is absolutely no precognition effect and the results occurred just due to the publication bias - a fixed effects model assuming the effect size to be zero and publication bias (<span class="math inline">\(H_{1}^{{\omega}f}\)</span>)</li>
<li>the experiments measured the same underlying precognition effect and the results were inflated due to the publication bias - a fixed effects model assuming publication bias (<span class="math inline">\(H_{1}^{{\omega}f}\)</span>)</li>
<li>each of the experiments measured a slightly different precognition effect and the results were inflated due to the publication bias - a random effects model assuming publication bias (<span class="math inline">\(H_{1}^{{\omega}r}\)</span>)</li>
</ol>
<p>If we were to fit the ensemble using the <code><a href="../reference/RoBMA.html">RoBMA()</a></code> function and specifying all of the priors, we would have ended with two more models than requested (the random effects model assuming the effect size to be zero (<span class="math inline">\(H_{0}^{\overline{\omega}r}\)</span>) and the random effects model assuming the effect size to be zero and publication bias (<span class="math inline">\(H_{0}^{{\omega}r}\)</span>)). Furthermore, we could not specify different parameters for the prior distributions for each model, which the following process allows (but we do not utilize it).</p>
<p>We start with fitting only the first model using the <code><a href="../reference/RoBMA.html">RoBMA()</a></code> function and we will continuously update the fitted object to include all of the models. We explicitly specify prior distributions for all parameters using the <code><a href="../reference/prior.html">prior()</a></code> function and we set the priors to be treated as the null priors for all parameters. We also add <code>silent = TRUE</code> to the <code>control</code> argument (to suppress the fitting messages) and set seed to ensure reproducibility of the results.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://fbartos.github.io/RoBMA/">RoBMA</a></span><span class="op">)</span>
<span class="co">#&gt; Loading required namespace: runjags</span>
<span class="co">#&gt; module RoBMA loaded</span>
<span class="co">#&gt; Parametrization of random effect models changed and all models are estimated using likelihood of effects sizes since version 1.2.0, see NEWS for more details.</span>

<span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/RoBMA.html">RoBMA</a></span><span class="op">(</span>t <span class="op">=</span> <span class="va">Bem2011</span><span class="op">$</span><span class="va">t</span>, n <span class="op">=</span> <span class="va">Bem2011</span><span class="op">$</span><span class="va">N</span>, study_names <span class="op">=</span> <span class="va">Bem2011</span><span class="op">$</span><span class="va">study</span>,
             priors_mu <span class="op">=</span> <span class="cn">NULL</span>, priors_tau <span class="op">=</span> <span class="cn">NULL</span>, priors_omega <span class="op">=</span> <span class="cn">NULL</span>,
             priors_mu_null    <span class="op">=</span> <span class="fu"><a href="../reference/prior.html">prior</a></span><span class="op">(</span><span class="st">"spike"</span>, parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>location <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span>,
             priors_tau_null   <span class="op">=</span> <span class="fu"><a href="../reference/prior.html">prior</a></span><span class="op">(</span><span class="st">"spike"</span>, parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>location <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span>,
             priors_omega_null <span class="op">=</span> <span class="fu"><a href="../reference/prior.html">prior</a></span><span class="op">(</span><span class="st">"spike"</span>, parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>location <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
             control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>silent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, seed <span class="op">=</span> <span class="fl">666</span><span class="op">)</span></code></pre></div>
<p>Before we add the second model to the ensemble, we need to decide on the prior distribution for the mean parameter. If precognition were to exist, the effect would be small since all casinos would be bankrupted otherwise. Also, negative precognition does not make a lot of sense. Therefore, we decide to use a normal distribution with mean = .15 and standard deviation 0.10, setting most of the probability around the small effect sizes. To get a better grasp of the prior distribution, we visualize it using the <code>plot.prior()</code> function (the figure can be created using the ggplot2 package by adding <code>plot_type == "ggplot"</code> argument).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/prior.html">prior</a></span><span class="op">(</span><span class="st">"normal"</span>, parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">.15</span>, sd <span class="op">=</span> <span class="fl">.10</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="CustomEnsembles_files/figure-html/unnamed-chunk-3-1.png" width="384" style="display: block; margin: auto;"></p>
<p>We add the second model to the ensemble using the <code><a href="../reference/update.RoBMA.html">update.RoBMA()</a></code> function. The function can also be used to many other purposes - updating settings, prior model probabilities, and refitting failed models. Here, we supply the fitted ensemble object and add an argument specifying the prior distribution of each parameter for the additional model. Since we want to add model 2 - we set the prior for the mu parameter to be treated as an alternative prior and the remaining priors treated as null priors. If we wanted, we could also specify <code>prior_odds</code> argument, to change the prior probability of the fitted model but we do not utilize this option here to keep the default value, which sets the prior odds for the new model to <code>1</code>. (Note that the arguments for specifying prior distributions in <code><a href="../reference/update.RoBMA.html">update.RoBMA()</a></code> function are <code>prior_X</code> - in singular, in comparison to <code><a href="../reference/RoBMA.html">RoBMA()</a></code> function that uses <code>priors_X</code> in plural.)</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html">update</a></span><span class="op">(</span><span class="va">fit</span>,
              prior_mu         <span class="op">=</span> <span class="fu"><a href="../reference/prior.html">prior</a></span><span class="op">(</span><span class="st">"normal"</span>, parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">.15</span>, sd <span class="op">=</span> <span class="fl">.10</span><span class="op">)</span><span class="op">)</span>,
              prior_tau_null   <span class="op">=</span> <span class="fu"><a href="../reference/prior.html">prior</a></span><span class="op">(</span><span class="st">"spike"</span>,  parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>location <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span>,
              prior_omega_null <span class="op">=</span> <span class="fu"><a href="../reference/prior.html">prior</a></span><span class="op">(</span><span class="st">"spike"</span>,  parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>location <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>We can inspect the updated ensemble to verify that it contains both models by adding <code>type = "models"</code> argument to the <code><a href="../reference/summary.RoBMA.html">summary.RoBMA()</a></code> function. We can also inspect the individual model estimates by changing the <code>type</code> argument to <code>type = "individual"</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fit</span>, type <span class="op">=</span> <span class="st">"models"</span><span class="op">)</span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; RoBMA(t = Bem2011$t, n = Bem2011$N, study_names = Bem2011$study, </span>
<span class="co">#&gt;     priors_mu = NULL, priors_tau = NULL, priors_omega = NULL, </span>
<span class="co">#&gt;     priors_mu_null = prior("spike", parameters = list(location = 0)), </span>
<span class="co">#&gt;     priors_tau_null = prior("spike", parameters = list(location = 0)), </span>
<span class="co">#&gt;     priors_omega_null = prior("spike", parameters = list(location = 1)), </span>
<span class="co">#&gt;     control = list(silent = TRUE), seed = 666)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Robust Bayesian Meta-Analysis</span>
<span class="co">#&gt;                       Prior mu Prior tau Prior omega Prior prob. Post. prob.</span>
<span class="co">#&gt; 1                     Spike(0)  Spike(0)    Spike(1)       0.500       0.000</span>
<span class="co">#&gt; 2 Normal(0.15, 0.1)[-Inf, Inf]  Spike(0)    Spike(1)       0.500       1.000</span>
<span class="co">#&gt;   log(MargLik)     Incl. BF</span>
<span class="co">#&gt; 1      -16.499        0.000</span>
<span class="co">#&gt; 2        1.033 41138030.065</span>

<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fit</span>, type <span class="op">=</span> <span class="st">"individual"</span><span class="op">)</span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; RoBMA(t = Bem2011$t, n = Bem2011$N, study_names = Bem2011$study, </span>
<span class="co">#&gt;     priors_mu = NULL, priors_tau = NULL, priors_omega = NULL, </span>
<span class="co">#&gt;     priors_mu_null = prior("spike", parameters = list(location = 0)), </span>
<span class="co">#&gt;     priors_tau_null = prior("spike", parameters = list(location = 0)), </span>
<span class="co">#&gt;     priors_omega_null = prior("spike", parameters = list(location = 1)), </span>
<span class="co">#&gt;     control = list(silent = TRUE), seed = 666)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Individual Models Summary</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Model: 1</span>
<span class="co">#&gt; Prior prob.: 0.500       Prior mu:   Spike(0)</span>
<span class="co">#&gt; log(MargLik):    -16.499     Prior tau:  Spike(0)</span>
<span class="co">#&gt; Post. prob.: 0.000       Prior omega:    Spike(1)</span>
<span class="co">#&gt; Incl. BF:    0.000       </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Model Coefficients:</span>
<span class="co">#&gt; NULL</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Model: 2</span>
<span class="co">#&gt; Prior prob.: 0.500       Prior mu:   Normal(0.15, 0.1)[-Inf, Inf]</span>
<span class="co">#&gt; log(MargLik):    1.033       Prior tau:  Spike(0)</span>
<span class="co">#&gt; Post. prob.: 1.000       Prior omega:    Spike(1)</span>
<span class="co">#&gt; Incl. BF:    41138030.065        </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Model Coefficients:</span>
<span class="co">#&gt;     Mean    SD  .025 Median  .975 MCMC error Error % of SD   ESS  Rhat</span>
<span class="co">#&gt; mu 0.329 0.053 0.225  0.329 0.433      0.000           0.6 27929 1.000</span></code></pre></div>
<p>We also need to decide on the prior distribution for the remaining models. We use the usual inverse-gamma(1, .15) prior distribution based on empirical heterogeneities <span class="citation">(Erp et al., 2017)</span> for the heterogeneity parameter tau in the random effects models (3, 6). For models assuming publication bias (4-6), we specify one-sided three-step weight function differentiating between marginally significant and significant <em>p</em>-values which we visualize bellow.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/prior.html">prior</a></span><span class="op">(</span><span class="st">"one.sided"</span>, parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>steps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">.10</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="CustomEnsembles_files/figure-html/unnamed-chunk-6-1.png" width="384" style="display: block; margin: auto;"></p>
<p>Now, we just need to add the remaining models to the ensemble using the <code><a href="../reference/update.RoBMA.html">update.RoBMA()</a></code> function as previously illustrated.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">### adding model 3</span>
<span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html">update</a></span><span class="op">(</span><span class="va">fit</span>,
              prior_mu         <span class="op">=</span> <span class="fu"><a href="../reference/prior.html">prior</a></span><span class="op">(</span><span class="st">"normal"</span>,   parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">.15</span>, sd <span class="op">=</span> <span class="fl">.10</span><span class="op">)</span><span class="op">)</span>,
              prior_tau        <span class="op">=</span> <span class="fu"><a href="../reference/prior.html">prior</a></span><span class="op">(</span><span class="st">"invgamma"</span>, parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">1</span>, scale <span class="op">=</span> <span class="fl">.15</span><span class="op">)</span><span class="op">)</span>,
              prior_omega_null <span class="op">=</span> <span class="fu"><a href="../reference/prior.html">prior</a></span><span class="op">(</span><span class="st">"spike"</span>,    parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>location <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co">### adding model 4             </span>
<span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html">update</a></span><span class="op">(</span><span class="va">fit</span>,
              prior_mu         <span class="op">=</span> <span class="fu"><a href="../reference/prior.html">prior</a></span><span class="op">(</span><span class="st">"spike"</span>,     parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>location <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span>,
              prior_tau        <span class="op">=</span> <span class="fu"><a href="../reference/prior.html">prior</a></span><span class="op">(</span><span class="st">"spike"</span>,     parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>location <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span>,
              prior_omega      <span class="op">=</span> <span class="fu"><a href="../reference/prior.html">prior</a></span><span class="op">(</span><span class="st">"one.sided"</span>, parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>steps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">.10</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
              
<span class="co">### adding model 5             </span>
<span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html">update</a></span><span class="op">(</span><span class="va">fit</span>,
              prior_mu         <span class="op">=</span> <span class="fu"><a href="../reference/prior.html">prior</a></span><span class="op">(</span><span class="st">"normal"</span>,    parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">.15</span>, sd <span class="op">=</span> <span class="fl">.10</span><span class="op">)</span><span class="op">)</span>,
              prior_tau        <span class="op">=</span> <span class="fu"><a href="../reference/prior.html">prior</a></span><span class="op">(</span><span class="st">"spike"</span>,     parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>location <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span>,
              prior_omega      <span class="op">=</span> <span class="fu"><a href="../reference/prior.html">prior</a></span><span class="op">(</span><span class="st">"one.sided"</span>, parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>steps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">.10</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
              
<span class="co">### adding model 6             </span>
<span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html">update</a></span><span class="op">(</span><span class="va">fit</span>,
              prior_mu         <span class="op">=</span> <span class="fu"><a href="../reference/prior.html">prior</a></span><span class="op">(</span><span class="st">"normal"</span>,    parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">.15</span>, sd <span class="op">=</span> <span class="fl">.10</span><span class="op">)</span><span class="op">)</span>,
              prior_tau        <span class="op">=</span> <span class="fu"><a href="../reference/prior.html">prior</a></span><span class="op">(</span><span class="st">"invgamma"</span>,  parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">1</span>, scale <span class="op">=</span> <span class="fl">.15</span><span class="op">)</span><span class="op">)</span>,
              prior_omega      <span class="op">=</span> <span class="fu"><a href="../reference/prior.html">prior</a></span><span class="op">(</span><span class="st">"one.sided"</span>, parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>steps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">.10</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>We verify that all of the requested models are included in the ensemble using the <code><a href="../reference/summary.RoBMA.html">summary.RoBMA()</a></code> function with <code>type = "models"</code> argument.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fit</span>, type <span class="op">=</span> <span class="st">"models"</span><span class="op">)</span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; RoBMA(t = Bem2011$t, n = Bem2011$N, study_names = Bem2011$study, </span>
<span class="co">#&gt;     priors_mu = NULL, priors_tau = NULL, priors_omega = NULL, </span>
<span class="co">#&gt;     priors_mu_null = prior("spike", parameters = list(location = 0)), </span>
<span class="co">#&gt;     priors_tau_null = prior("spike", parameters = list(location = 0)), </span>
<span class="co">#&gt;     priors_omega_null = prior("spike", parameters = list(location = 1)), </span>
<span class="co">#&gt;     control = list(silent = TRUE), seed = 666)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Robust Bayesian Meta-Analysis</span>
<span class="co">#&gt;                       Prior mu                 Prior tau</span>
<span class="co">#&gt; 1                     Spike(0)                  Spike(0)</span>
<span class="co">#&gt; 2 Normal(0.15, 0.1)[-Inf, Inf]                  Spike(0)</span>
<span class="co">#&gt; 3 Normal(0.15, 0.1)[-Inf, Inf] InvGamma(1, 0.15)[0, Inf]</span>
<span class="co">#&gt; 4                     Spike(0)                  Spike(0)</span>
<span class="co">#&gt; 5 Normal(0.15, 0.1)[-Inf, Inf]                  Spike(0)</span>
<span class="co">#&gt; 6 Normal(0.15, 0.1)[-Inf, Inf] InvGamma(1, 0.15)[0, Inf]</span>
<span class="co">#&gt;                         Prior omega Prior prob. Post. prob. log(MargLik)</span>
<span class="co">#&gt; 1                          Spike(1)       0.167       0.000      -16.499</span>
<span class="co">#&gt; 2                          Spike(1)       0.167       0.008        1.033</span>
<span class="co">#&gt; 3                          Spike(1)       0.167       0.002       -0.153</span>
<span class="co">#&gt; 4 One-sided((0.1, 0.05), (1, 1, 1))       0.167       0.038        2.579</span>
<span class="co">#&gt; 5 One-sided((0.1, 0.05), (1, 1, 1))       0.167       0.642        5.417</span>
<span class="co">#&gt; 6 One-sided((0.1, 0.05), (1, 1, 1))       0.167       0.310        4.688</span>
<span class="co">#&gt;   Incl. BF</span>
<span class="co">#&gt; 1    0.000</span>
<span class="co">#&gt; 2    0.040</span>
<span class="co">#&gt; 3    0.012</span>
<span class="co">#&gt; 4    0.195</span>
<span class="co">#&gt; 5    8.973</span>
<span class="co">#&gt; 6    2.244</span></code></pre></div>
</div>
<div id="using-the-fitted-ensemble" class="section level3">
<h3 class="hasAnchor">
<a href="#using-the-fitted-ensemble" class="anchor"></a>Using the fitted ensemble</h3>
<p>Finally, we use the <code><a href="../reference/summary.RoBMA.html">summary.RoBMA()</a></code> function to inspect the model results.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; RoBMA(t = Bem2011$t, n = Bem2011$N, study_names = Bem2011$study, </span>
<span class="co">#&gt;     priors_mu = NULL, priors_tau = NULL, priors_omega = NULL, </span>
<span class="co">#&gt;     priors_mu_null = prior("spike", parameters = list(location = 0)), </span>
<span class="co">#&gt;     priors_tau_null = prior("spike", parameters = list(location = 0)), </span>
<span class="co">#&gt;     priors_omega_null = prior("spike", parameters = list(location = 1)), </span>
<span class="co">#&gt;     control = list(silent = TRUE), seed = 666)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Robust Bayesian Meta-Analysis</span>
<span class="co">#&gt;               Models Prior prob. Post. prob.     Incl. BF</span>
<span class="co">#&gt; Effect           5/6       0.833       1.000 1.026453e+09</span>
<span class="co">#&gt; Heterogeneity    4/6       0.667       0.992 6.187900e+01</span>
<span class="co">#&gt; Pub. bias        3/6       0.500       0.990 9.457000e+01</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Model-averaged estimates</span>
<span class="co">#&gt;                  Mean Median 0.025 0.975</span>
<span class="co">#&gt; mu              0.203  0.209 0.000 0.359</span>
<span class="co">#&gt; tau             0.039  0.000 0.000 0.234</span>
<span class="co">#&gt; omega[0,0.05]   1.000  1.000 1.000 1.000</span>
<span class="co">#&gt; omega[0.05,0.1] 0.504  0.488 0.084 0.976</span>
<span class="co">#&gt; omega[0.1,1]    0.091  0.047 0.001 0.435</span>
<span class="co">#&gt; (Estimated omegas correspond to one-sided p-values)</span></code></pre></div>
<p>The finalized ensemble can be treated as any other <code>RoBMA</code> using the <code><a href="../reference/summary.RoBMA.html">summary.RoBMA()</a></code>, <code><a href="../reference/plot.RoBMA.html">plot.RoBMA()</a></code>, and <code><a href="../reference/diagnostics.html">diagnostics()</a></code> function. The results from our ensemble indicate support for presence of the effect, <span class="math inline">\(BF_{10} = 1.03e+09\)</span>, heterogeneity, <span class="math inline">\(BF_{rf} = 61.88\)</span> , and publication bias, <span class="math inline">\(BF_{\omega{\overline{\omega}}} = 94.57\)</span>.</p>
<p>For example, we can use the <code><a href="../reference/plot.RoBMA.html">plot.RoBMA()</a></code> with the <code>parameter = "mu", prior = TRUE</code> arguments to plot the prior (grey) and posterior distribution (black) for the effect size.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">fit</span>, parameter <span class="op">=</span> <span class="st">"mu"</span>, prior <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="CustomEnsembles_files/figure-html/unnamed-chunk-10-1.png" width="384" style="display: block; margin: auto;"></p>
<p>Or change the parameter argument to <code>parameter = "omega"</code> to plot the prior (grey dashed lines) and posterior (black lines, with gray area filling the 95% CI) distribution for the weight function.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">fit</span>, parameter <span class="op">=</span> <span class="st">"omega"</span>, prior <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="CustomEnsembles_files/figure-html/unnamed-chunk-11-1.png" width="384" style="display: block; margin: auto;"></p>
</div>
<div id="final-words" class="section level3">
<h3 class="hasAnchor">
<a href="#final-words" class="anchor"></a>Final words</h3>
<p>As pointed out at the beginning of the vignette, the intention of this example was not to draw inference about the results of <span class="citation">Bem (2011)</span> studies. Furthermore, selection models and their ensembles implemented in <code>RoBMA</code> are only able to control and correct for publication bias. Using a simulation study, we showed that the <code>RoBMA</code> default 12 model meta-analytic ensemble is capable of testing and estimating parameters under different conditions assuming that the publication bias operates on <em>p</em>-values. However, we also showed that <code>RoBMA</code>, as well as most of the other methods, fail to recover the true effect sizes in cases with severe p-hacking <span class="citation">(Maier et al., 2020)</span>.</p>
</div>
<div id="references" class="section level3 unnumbered">
<h3 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h3>
<div id="refs" class="references">
<div id="ref-bartos2020">
<p>Bartoš, F., Maier, M., &amp; Wagenmakers, E.-J. (2020). Adjusting for publication bias in JASP — selection models and robust bayesian meta-analysis. In <em>PsyArXiv</em>. <a href="https://doi.org/10.31234/osf.io/75bqn">https://doi.org/10.31234/osf.io/75bqn</a></p>
</div>
<div id="ref-bem2011">
<p>Bem, D. J. (2011). Feeling the future: Experimental evidence for anomalous retroactive influences on cognition and affect. <em>Journal of Personality and Social Psychology</em>, <em>100</em>(3), 407. <a href="https://doi.org/10.1037/a0021524">https://doi.org/10.1037/a0021524</a></p>
</div>
<div id="ref-bem2011reply">
<p>Bem, D. J., Utts, J., &amp; Johnson, W. O. (2011). Must psychologists change the way they analyze their data? <em>Journal of Personality and Social Psychology</em>, <em>101</em>(4), 716. <a href="https://doi.org/10.1037/a0024777">https://doi.org/10.1037/a0024777</a></p>
</div>
<div id="ref-vanErp2017">
<p>Erp, S. van, Verhagen, J., Grasman, R. P., &amp; Wagenmakers, E.-J. (2017). Estimates of between-study heterogeneity for 705 meta-analyses reported in Psychological Bulletin from 1990–2013. <em>Journal of Open Psychology Data</em>, <em>5</em>(1). <a href="http://doi.org/10.5334/jopd.33">http://doi.org/10.5334/jopd.33</a></p>
</div>
<div id="ref-gronau2017">
<p>Gronau, Q. F., Van Erp, S., Heck, D. W., Cesario, J., Jonas, K. J., &amp; Wagenmakers, E.-J. (2017). A Bayesian model-averaged meta-analysis of the power pose effect with informed and default priors: The case of felt power. <em>Comprehensive Results in Social Psychology</em>, <em>2</em>(1), 123–138. <a href="https://doi.org/10.1080/23743603.2017.1326760">https://doi.org/10.1080/23743603.2017.1326760</a></p>
</div>
<div id="ref-maier2020">
<p>Maier, M., Bartoš, F., &amp; Wagenmakers, E.-J. (2020). Robust Bayesian meta-analysis: Addressing publication bias with model-averaging. In <em>PsyArXiv</em>. <a href="https://doi.org/10.31234/osf.io/u4cns">https://doi.org/10.31234/osf.io/u4cns</a></p>
</div>
<div id="ref-rouder2011bemReply">
<p>Rouder, J. N., &amp; Morey, R. D. (2011). A Bayes factor meta-analysis of Bem’s ESP claim. <em>Psychonomic Bulletin &amp; Review</em>, <em>18</em>(4), 682–689. <a href="https://doi.org/10.3758/s13423-011-0088-7">https://doi.org/10.3758/s13423-011-0088-7</a></p>
</div>
<div id="ref-schimmack2018bem">
<p>Schimmack, U. (2018). My email correspondence with Daryl J. Bem about the data for his 2011 article “Feeling the future”. In <em>Replicability-Index</em>. <a href="https://replicationindex.com/2018/01/20/my-email-correspondence-with-daryl-j-bem-about-the-data-for-his-2011-article-feeling-the-future/">https://replicationindex.com/2018/01/20/my-email-correspondence-with-daryl-j-bem-about-the-data-for-his-2011-article-feeling-the-future/</a></p>
</div>
<div id="ref-wagenmakers2011bemReply">
<p>Wagenmakers, E.-J., Wetzels, R., Borsboom, D., &amp; Van Der Maas, H. L. (2011). Why psychologists must change the way they analyze their data: The case of psi: Comment on Bem (2011). <em>Journal of Personality and Social Psychology</em>, <em>100</em>(3), 426–432. <a href="https://doi.org/10.1037/a0022790">https://doi.org/10.1037/a0022790</a></p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by František Bartoš, Maximilian Maier.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
