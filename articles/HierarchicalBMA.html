<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Hierarchical Bayesian Model-Averaged Meta-Analysis • RoBMA</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Hierarchical Bayesian Model-Averaged Meta-Analysis">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">RoBMA</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.5.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/CustomEnsembles.html">Fitting Custom Meta-Analytic Ensembles</a></li>
    <li><a class="dropdown-item" href="../articles/FastRoBMA.html">Fast Robust Bayesian Meta-Analysis via Spike and Slab Algorithm</a></li>
    <li><a class="dropdown-item" href="../articles/HierarchicalBMA.html">Hierarchical Bayesian Model-Averaged Meta-Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/MedicineBiBMA.html">Informed Bayesian Model-Averaged Meta-Analysis with Binary Outcomes</a></li>
    <li><a class="dropdown-item" href="../articles/MedicineBMA.html">Informed Bayesian Model-Averaged Meta-Analysis in Medicine</a></li>
    <li><a class="dropdown-item" href="../articles/MetaRegression.html">Robust Bayesian Model-Averaged Meta-Regression</a></li>
    <li><a class="dropdown-item" href="../articles/ReproducingBMA.html">Reproducing Bayesian Model-Averaged Meta-Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/Tutorial.html">Tutorial: Adjusting for Publication Bias in JASP and R - Selection Models, PET-PEESE, and Robust Bayesian Meta-Analysis</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/FBartos/RoBMA/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Hierarchical Bayesian Model-Averaged Meta-Analysis</h1>
                        <h4 data-toc-skip class="author">František
Bartoš</h4>
            
            <h4 data-toc-skip class="date">2025-07-17</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/FBartos/RoBMA/blob/master/vignettes/HierarchicalBMA.Rmd" class="external-link"><code>vignettes/HierarchicalBMA.Rmd</code></a></small>
      <div class="d-none name"><code>HierarchicalBMA.Rmd</code></div>
    </div>

    
    
<p>Hierarchical (or multilevel/3-level) meta-analysis adjusts for the
dependency of effect sizes due to clustering in the data. For example,
effect size estimates from multiple experiments reported in the same
manuscript might be expected to be more similar than effect sizes from a
different paper <span class="citation">(Konstantopoulos, 2011)</span>.
This vignette illustrates how to deal with such dependencies among
effect size estimates (in cases with simple nested structure) using the
Bayesian model-averaged meta-analysis (BMA) <span class="citation">(Bartoš et al., 2021; Gronau et al., 2017,
2021)</span>. (See other vignettes for more details on BMA: <a href="ReproducingBMA.html">Reproducing BMA</a> or <a href="MedicineBMA.html">Informed BMA in medicine</a>.)</p>
<p>First, we introduce the example data set. Second, we illustrate the
frequentist hierarchical meta-analysis with the <code>metafor</code> R
package and discuss the results. Third, we outline the hierarchical
meta-analysis parameterization. Fourth, we estimate the Bayesian
model-averaged hierarchical meta-analysis. Finally, we conclude by
discussing further extensions and publication bias adjustment.</p>
<p>Note that since version 3.5 of the <code>RoBMA</code> package, the
hierarchical meta-analysis and meta-regression can use the
spike-and-slab model-averaging algorithm described in <a href="FastRoBMA.html">Fast Robust Bayesian Meta-Analysis via Spike and
Slab Algorithm</a>. The spike-and-slab model-averaging algorithm is a
more efficient alternative to the bridge algorithm, which is the current
default in the <code>RoBMA</code> package. For non-selection models, the
likelihood used in the spike-and-slab algorithm is equivalent to the
bridge algorithm. However, the likelihood in the selection models is
modified since marginalization of the random-effects is not performed.
As such, the selection models use likelihood that closely approximates
the exact selection model likelihood. In our testing and a simulation
study, found that the approximate selection likelihood performs
reasonably well and is better than the non-hierarchical exact likelihood
model when within-study dependencies are present.</p>
<div class="section level3">
<h3 id="example-data-set">Example Data Set<a class="anchor" aria-label="anchor" href="#example-data-set"></a>
</h3>
<p>We use the <code>dat.konstantopoulos2011</code> data set from the
<code>metadat</code> R package <span class="citation">(Thomas et al.,
2019)</span> that is used for the same functionality in the metafor
<span class="citation">(Wolfgang, 2010)</span> R package. We roughly
follow the example in the data set’s help file,
<code>?dat.konstantopoulos2011</code>. The data set consists of 56
studies estimating the effects of modified school calendars on students’
achievement. The 56 studies were run in individual schools, which can be
grouped into 11 districts. We might expect more similar effect size
estimates from schools in the same district – in other words, the effect
size estimates from the same district might not be completely
independent. Consequently, we might want to adjust for this dependency
(clustering) between the effect size estimates to draw a more
appropriate inference.</p>
<p>First, we load the data set, assign it to the <code>dat</code>
object, and inspect the first few rows.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"dat.konstantopoulos2011"</span>, package <span class="op">=</span> <span class="st">"metadat"</span><span class="op">)</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">dat.konstantopoulos2011</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span>
<span><span class="co">#&gt;   district school study year    yi    vi</span></span>
<span><span class="co">#&gt; 1       11      1     1 1976 -0.18 0.118</span></span>
<span><span class="co">#&gt; 2       11      2     2 1976 -0.22 0.118</span></span>
<span><span class="co">#&gt; 3       11      3     3 1976  0.23 0.144</span></span>
<span><span class="co">#&gt; 4       11      4     4 1976 -0.30 0.144</span></span>
<span><span class="co">#&gt; 5       12      1     5 1989  0.13 0.014</span></span>
<span><span class="co">#&gt; 6       12      2     6 1989 -0.26 0.014</span></span></code></pre></div>
<p>In the following analyses, we use the following variables:</p>
<ul>
<li>
<code>yi</code>, standardized mean differences,</li>
<li>
<code>vi</code>, sampling variances of the standardized mean
differences,</li>
<li>
<code>district</code>, district id which distinguishes among the
districts,</li>
<li>and <code>school</code>, that distinguishes among different schools
within the same district.</li>
</ul>
</div>
<div class="section level3">
<h3 id="frequentist-hierarchical-meta-analysis-with-metafor">Frequentist Hierarchical Meta-Analysis with
<code>metafor</code><a class="anchor" aria-label="anchor" href="#frequentist-hierarchical-meta-analysis-with-metafor"></a>
</h3>
<p>We follow the data set’s help file and fit a simple random effects
meta-analysis using the <code>rma()</code> function from
<code>metafor</code> package. This model ignores the dependency between
effect size estimates. We use this simple model as our starting point
and as a comparison with the later models.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_metafor.0</span> <span class="op">&lt;-</span> <span class="fu">metafor</span><span class="fu">::</span><span class="fu"><a href="https://wviechtb.github.io/metafor/reference/rma.uni.html" class="external-link">rma</a></span><span class="op">(</span>yi <span class="op">=</span> <span class="va">yi</span>, vi <span class="op">=</span> <span class="va">vi</span>, data <span class="op">=</span> <span class="va">dat</span><span class="op">)</span></span>
<span><span class="va">fit_metafor.0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Random-Effects Model (k = 56; tau^2 estimator: REML)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; tau^2 (estimated amount of total heterogeneity): 0.0884 (SE = 0.0202)</span></span>
<span><span class="co">#&gt; tau (square root of estimated tau^2 value):      0.2974</span></span>
<span><span class="co">#&gt; I^2 (total heterogeneity / total variability):   94.70%</span></span>
<span><span class="co">#&gt; H^2 (total variability / sampling variability):  18.89</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Test for Heterogeneity:</span></span>
<span><span class="co">#&gt; Q(df = 55) = 578.8640, p-val &lt; .0001</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model Results:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; estimate      se    zval    pval   ci.lb   ci.ub     </span></span>
<span><span class="co">#&gt;   0.1279  0.0439  2.9161  0.0035  0.0419  0.2139  ** </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre></div>
<p>The model summary returns a small but statistically significant
effect size estimate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>μ</mi><mo>=</mo><mn>0.128</mn></mrow><annotation encoding="application/x-tex">\mu = 0.128</annotation></semantics></math>
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">se</mtext><mo>=</mo><mn>0.044</mn></mrow><annotation encoding="application/x-tex">\text{se} = 0.044</annotation></semantics></math>)
and a considerable heterogeneity estimate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>τ</mi><mo>=</mo><mn>0.297</mn></mrow><annotation encoding="application/x-tex">\tau = 0.297</annotation></semantics></math>.</p>
<p>We extend the model to account for the hierarchical structure of the
data, i.e., schools within districts, by using the <code>rma.mv()</code>
function from the <code>metafor</code> package and extending it with the
<code>random = ~ school | district</code> argument.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_metafor</span> <span class="op">&lt;-</span> <span class="fu">metafor</span><span class="fu">::</span><span class="fu"><a href="https://wviechtb.github.io/metafor/reference/rma.mv.html" class="external-link">rma.mv</a></span><span class="op">(</span><span class="va">yi</span>, <span class="va">vi</span>, random <span class="op">=</span> <span class="op">~</span> <span class="va">school</span> <span class="op">|</span> <span class="va">district</span>, data <span class="op">=</span> <span class="va">dat</span><span class="op">)</span></span>
<span><span class="va">fit_metafor</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Multivariate Meta-Analysis Model (k = 56; method: REML)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Variance Components:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; outer factor: district (nlvls = 11)</span></span>
<span><span class="co">#&gt; inner factor: school   (nlvls = 11)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;             estim    sqrt  fixed </span></span>
<span><span class="co">#&gt; tau^2      0.0978  0.3127     no </span></span>
<span><span class="co">#&gt; rho        0.6653             no </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Test for Heterogeneity:</span></span>
<span><span class="co">#&gt; Q(df = 55) = 578.8640, p-val &lt; .0001</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model Results:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; estimate      se    zval    pval   ci.lb   ci.ub    </span></span>
<span><span class="co">#&gt;   0.1847  0.0846  2.1845  0.0289  0.0190  0.3504  * </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre></div>
<p>We find that accounting for the hierarchical structure of the data
results in (1) a slightly larger effect size estimate
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>μ</mi><mo>=</mo><mn>0.187</mn></mrow><annotation encoding="application/x-tex">\mu = 0.187</annotation></semantics></math>)
and (2) larger standard error of the effect size estimate
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">se</mtext><mo>=</mo><mn>0.085</mn></mrow><annotation encoding="application/x-tex">\text{se} = 0.085</annotation></semantics></math>).
The larger standard error is a natural consequence of accounting for the
dependency between the effect sizes. Because the effect sizes are
dependent, they contribute less additional information than independent
effect sizes would. Specifying the hierarchical model then accounts for
the dependency by estimating similarity between the estimates from the
same cluster (school) and discounting the information borrowed from each
estimate. The estimate of the similarity among estimates from the same
cluster is summarized in the <code>\rho = 0.666</code> estimate.</p>
</div>
<div class="section level3">
<h3 id="specifications-of-hierarchical-meta-analysis">Specifications of Hierarchical Meta-Analysis<a class="anchor" aria-label="anchor" href="#specifications-of-hierarchical-meta-analysis"></a>
</h3>
<p>We specify a simple hierarchical meta-analytic model (see <span class="citation">Konstantopoulos (2011)</span> for an example). Using
distributional notation, we can describe the data generating process as
a multi-stage sampling procedure. In a nutshell, we assume the existence
of an overall mean effect
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>μ</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>.
Next, we assume that the effect sizes in each district
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>…</mi><mo>,</mo><mi>K</mi></mrow><annotation encoding="application/x-tex">k = 1, \dots, K</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>γ</mi><mi>k</mi></msub><annotation encoding="application/x-tex">\gamma_k</annotation></semantics></math>,
systematically differ from the mean effect, with the variance of the
district-level effects summarized with heterogeneity
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>τ</mi><mi>b</mi></msub><annotation encoding="application/x-tex">\tau_{b}</annotation></semantics></math>
(as between). Furthermore, we assume that the true effects
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>θ</mi><mrow><mi>k</mi><mo>,</mo><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">\theta_{k,j}</annotation></semantics></math>
of each study
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>…</mi><msub><mi>J</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">j = 1, \dots J_k</annotation></semantics></math>
systematically differ from the district-level effect, with the variance
of the study effects from the district-level effect summarized with
heterogeneity
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>τ</mi><mi>w</mi></msub><annotation encoding="application/x-tex">\tau_{w}</annotation></semantics></math>
(as within). Finally, the observed effect sizes
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mrow><mi>k</mi><mo>,</mo><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">y_{k,j}</annotation></semantics></math>
that differ from the true effects
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mrow><mi>k</mi><mo>,</mo><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">y_{k,j}</annotation></semantics></math>
due to random errors
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mtext mathvariant="normal">se</mtext><mrow><mi>k</mi><mo>,</mo><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">\text{se}_{k,j}</annotation></semantics></math>.</p>
<p>Mathematically, we can describe such a model as:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>γ</mi><mi>k</mi></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>∼</mo><mtext mathvariant="normal">N</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>μ</mi><mo>,</mo><msubsup><mi>τ</mi><mi>b</mi><mn>2</mn></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>θ</mi><mrow><mi>k</mi><mo>,</mo><mi>j</mi></mrow></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>∼</mo><mtext mathvariant="normal">N</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>γ</mi><mi>k</mi></msub><mo>,</mo><msubsup><mi>τ</mi><mi>w</mi><mn>2</mn></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>y</mi><mrow><mi>k</mi><mo>,</mo><mi>j</mi></mrow></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>∼</mo><mtext mathvariant="normal">N</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>θ</mi><mrow><mi>k</mi><mo>,</mo><mi>j</mi></mrow></msub><mo>,</mo><msub><mtext mathvariant="normal">se</mtext><mrow><mi>k</mi><mo>,</mo><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{aligned}
  \gamma_k     &amp;\sim \text{N}(\mu,          \tau_b^2),\\
  \theta_{k,j} &amp;\sim \text{N}(\gamma_k,     \tau_w^2),\\
   y_{k,j}     &amp;\sim \text{N}(\theta_{k,j}, \text{se}_{k,j}).\\
\end{aligned}
</annotation></semantics></math> Where N() denotes a normal distribution
with mean and variance.</p>
<p>Conveniently, and with a bit of algebra, we do not need to estimate
the district-level and true study effects. Instead, we marginalize them
out, and we sample the observed effect sizes from each district
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mrow><mi>k</mi><mo>,</mo><mi>.</mi></mrow></msub><annotation encoding="application/x-tex">y_{k,.}</annotation></semantics></math>
directly from a multivariate normal distributions, MN(), with a common
mean
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>μ</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>
and covariance matrix S:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>y</mi><mrow><mi>k</mi><mo>,</mo><mi>.</mi></mrow></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>∼</mo><mtext mathvariant="normal">MN</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>μ</mi><mo>,</mo><mtext mathvariant="normal">S</mtext><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mtext mathvariant="normal">S</mtext></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mrow><mo stretchy="true" form="prefix">[</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><msubsup><mi>τ</mi><mi>b</mi><mn>2</mn></msubsup><mo>+</mo><msubsup><mi>τ</mi><mi>w</mi><mn>2</mn></msubsup><mo>+</mo><msubsup><mtext mathvariant="normal">se</mtext><mn>1</mn><mn>2</mn></msubsup></mtd><mtd columnalign="center" style="text-align: center"><msubsup><mi>τ</mi><mi>w</mi><mn>2</mn></msubsup></mtd><mtd columnalign="center" style="text-align: center"><mi>…</mi></mtd><mtd columnalign="center" style="text-align: center"><msubsup><mi>τ</mi><mi>w</mi><mn>2</mn></msubsup></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msubsup><mi>τ</mi><mi>w</mi><mn>2</mn></msubsup></mtd><mtd columnalign="center" style="text-align: center"><msubsup><mi>τ</mi><mi>b</mi><mn>2</mn></msubsup><mo>+</mo><msubsup><mi>τ</mi><mi>w</mi><mn>2</mn></msubsup><mo>+</mo><msubsup><mtext mathvariant="normal">se</mtext><mn>2</mn><mn>2</mn></msubsup></mtd><mtd columnalign="center" style="text-align: center"><mi>…</mi></mtd><mtd columnalign="center" style="text-align: center"><msubsup><mi>τ</mi><mi>w</mi><mn>2</mn></msubsup></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mi>…</mi></mtd><mtd columnalign="center" style="text-align: center"><mi>…</mi></mtd><mtd columnalign="center" style="text-align: center"><mi>…</mi></mtd><mtd columnalign="center" style="text-align: center"><mi>…</mi></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msubsup><mi>τ</mi><mi>w</mi><mn>2</mn></msubsup></mtd><mtd columnalign="center" style="text-align: center"><msubsup><mi>τ</mi><mi>w</mi><mn>2</mn></msubsup></mtd><mtd columnalign="center" style="text-align: center"><mi>…</mi></mtd><mtd columnalign="center" style="text-align: center"><msubsup><mi>τ</mi><mi>b</mi><mn>2</mn></msubsup><mo>+</mo><msubsup><mi>τ</mi><mi>w</mi><mn>2</mn></msubsup><mo>+</mo><msubsup><mtext mathvariant="normal">se</mtext><msub><mi>J</mi><mi>k</mi></msub><mn>2</mn></msubsup></mtd><mtd columnalign="center" style="text-align: center"></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"></mtd></mtr></mtable><mo stretchy="true" form="postfix">]</mo></mrow><mi>.</mi></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{aligned}
   y_{k,.}  &amp;\sim \text{MN}(\mu, \text{S}),\\
   \text{S} &amp;= \begin{bmatrix} 
      \tau_b^2 + \tau_w^2 + \text{se}_1^2 &amp; \tau_w^2 &amp; \dots &amp; \tau_w^2  \\
      \tau_w^2 &amp; \tau_b^2 + \tau_w^2 + \text{se}_2^2 &amp; \dots &amp; \tau_w^2  \\
      \dots  &amp; \dots &amp; \dots &amp; \dots \\
      \tau_w^2 &amp; \tau_w^2 &amp; \dots &amp; \tau_b^2 + \tau_w^2 + \text{se}_{J_k}^2 &amp; \\
  \end{bmatrix}.
\end{aligned}
</annotation></semantics></math> The random effects marginalization is
helpful as it allows us to sample fewer parameters from the posterior
distribution (which significantly simplifies marginal likelihood
estimation via bridge sampling). Furthermore, the marginalization allows
us to properly specify selection model publication bias adjustment
models – the marginalization propagates the selection process up through
all the sampling steps at once (we cannot proceed with the sequential
sampling as the selection procedure on the observed effect sizes
modifies the sampling distributions of all the preceding levels).</p>
<p>We can further re-parameterize the model by performing the following
substitution,
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><msup><mi>τ</mi><mn>2</mn></msup></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><msubsup><mi>τ</mi><mi>b</mi><mn>2</mn></msubsup><mo>+</mo><msubsup><mi>τ</mi><mi>w</mi><mn>2</mn></msubsup><mo>,</mo></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mi>ρ</mi></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mfrac><msubsup><mi>τ</mi><mi>w</mi><mn>2</mn></msubsup><mrow><msubsup><mi>τ</mi><mi>b</mi><mn>2</mn></msubsup><mo>+</mo><msubsup><mi>τ</mi><mi>w</mi><mn>2</mn></msubsup></mrow></mfrac><mo>,</mo></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{aligned}
   \tau^2 &amp;= \tau_b^2 + \tau_w^2,\\
   \rho   &amp;= \frac{\tau_w^2}{\tau_b^2 + \tau_w^2},
\end{aligned}
</annotation></semantics></math> and specifying the covariance matrix
using the inter-study correlation
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ρ</mi><annotation encoding="application/x-tex">\rho</annotation></semantics></math>,
total heterogeneity
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>τ</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>,
and the standard errors
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mtext mathvariant="normal">se</mtext><mi>.</mi></msub><annotation encoding="application/x-tex">\text{se}_{.}</annotation></semantics></math>:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mtext mathvariant="normal">S</mtext></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mrow><mo stretchy="true" form="prefix">[</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><msup><mi>τ</mi><mn>2</mn></msup><mo>+</mo><msubsup><mtext mathvariant="normal">se</mtext><mn>1</mn><mn>2</mn></msubsup></mtd><mtd columnalign="center" style="text-align: center"><mi>ρ</mi><msup><mi>τ</mi><mn>2</mn></msup></mtd><mtd columnalign="center" style="text-align: center"><mi>…</mi></mtd><mtd columnalign="center" style="text-align: center"><mi>ρ</mi><msup><mi>τ</mi><mn>2</mn></msup></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mi>ρ</mi><msup><mi>τ</mi><mn>2</mn></msup></mtd><mtd columnalign="center" style="text-align: center"><msup><mi>τ</mi><mn>2</mn></msup><mo>+</mo><msubsup><mtext mathvariant="normal">se</mtext><mn>2</mn><mn>2</mn></msubsup></mtd><mtd columnalign="center" style="text-align: center"><mi>…</mi></mtd><mtd columnalign="center" style="text-align: center"><mi>ρ</mi><msup><mi>τ</mi><mn>2</mn></msup></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mi>…</mi></mtd><mtd columnalign="center" style="text-align: center"><mi>…</mi></mtd><mtd columnalign="center" style="text-align: center"><mi>…</mi></mtd><mtd columnalign="center" style="text-align: center"><mi>…</mi></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mi>ρ</mi><msup><mi>τ</mi><mn>2</mn></msup></mtd><mtd columnalign="center" style="text-align: center"><mi>ρ</mi><msup><mi>τ</mi><mn>2</mn></msup></mtd><mtd columnalign="center" style="text-align: center"><mi>…</mi></mtd><mtd columnalign="center" style="text-align: center"><msup><mi>τ</mi><mn>2</mn></msup><mo>+</mo><msubsup><mtext mathvariant="normal">se</mtext><msub><mi>J</mi><mi>k</mi></msub><mn>2</mn></msubsup></mtd><mtd columnalign="center" style="text-align: center"></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"></mtd></mtr></mtable><mo stretchy="true" form="postfix">]</mo></mrow><mi>.</mi></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{aligned}
   \text{S} &amp;= \begin{bmatrix} 
      \tau^2 + \text{se}_1^2 &amp; \rho\tau^2 &amp; \dots &amp; \rho\tau^2  \\
      \rho\tau^2 &amp; \tau^2 + \text{se}_2^2 &amp; \dots &amp; \rho\tau^2  \\
      \dots  &amp; \dots &amp; \dots &amp; \dots \\
      \rho\tau^2 &amp; \rho\tau^2 &amp; \dots &amp; \tau^2 + \text{se}_{J_k}^2 &amp; \\
  \end{bmatrix}.
\end{aligned}
</annotation></semantics></math> This specification corresponds to the
compound symmetry covariance matrix of random effects, the default
settings in the <code><a href="https://wviechtb.github.io/metafor/reference/rma.mv.html" class="external-link">metafor::rma.mv()</a></code> function. More
importantly, it allows us to easily specify prior distributions on the
correlation coefficient
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ρ</mi><annotation encoding="application/x-tex">\rho</annotation></semantics></math>
and the total heterogeneity
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>τ</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>.</p>
</div>
<div class="section level3">
<h3 id="hierarchical-bayesian-model-averaged-meta-analysis-with-robma">Hierarchical Bayesian Model-Averaged Meta-Analysis with
<code>RoBMA</code><a class="anchor" aria-label="anchor" href="#hierarchical-bayesian-model-averaged-meta-analysis-with-robma"></a>
</h3>
<p>Before we estimate the complete Hierarchical Bayesian Model-Averaged
Meta-Analysis (hBMA) with the <code>RoBMA</code> package, we briefly
reproduce the simpler models we estimated with the <code>metafor</code>
package in the previous section.</p>
<div class="section level4">
<h4 id="bayesian-random-effects-meta-analysis">Bayesian Random Effects Meta-Analysis<a class="anchor" aria-label="anchor" href="#bayesian-random-effects-meta-analysis"></a>
</h4>
<p>First, we estimate a simple Bayesian random effects meta-analysis
(corresponding to <code>fit_metafor.0</code>). We use
<code>the RoBMA()</code> function and specify the effect sizes and
sampling variances via the <code>d = dat$yi</code> and
<code>v = dat$vi</code> arguments. We set the
<code>priors_effect_null</code>, <code>priors_heterogeneity_null</code>,
and <code>priors_bias</code> arguments to null to omit models assuming
the absence of the effect, heterogeneity, and the publication bias
adjustment components.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit.0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/RoBMA.html">RoBMA</a></span><span class="op">(</span>d <span class="op">=</span> <span class="va">dat</span><span class="op">$</span><span class="va">yi</span>, v <span class="op">=</span> <span class="va">dat</span><span class="op">$</span><span class="va">vi</span>,</span>
<span>               priors_effect_null        <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>               priors_heterogeneity_null <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>               priors_bias               <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>               parallel <span class="op">=</span> <span class="cn">TRUE</span>, seed <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>We generate a complete summary for the only estimated model by adding
the <code>type = "individual"</code> argument to the
<code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> function.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit.0</span>, type <span class="op">=</span> <span class="st">"individual"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; RoBMA(d = dat$yi, v = dat$vi, priors_bias = NULL, priors_effect_null = NULL, </span></span>
<span><span class="co">#&gt;     priors_heterogeneity_null = NULL, parallel = TRUE, seed = 1)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Robust Bayesian meta-analysis                                                               </span></span>
<span><span class="co">#&gt;  Model              1             Parameter prior distributions</span></span>
<span><span class="co">#&gt;  Prior prob.    1.000                    mu ~ Normal(0, 1)     </span></span>
<span><span class="co">#&gt;  log(marglik)   17.67                   tau ~ InvGamma(1, 0.15)</span></span>
<span><span class="co">#&gt;  Post. prob.    1.000                                          </span></span>
<span><span class="co">#&gt;  Inclusion BF     Inf                                          </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Parameter estimates:</span></span>
<span><span class="co">#&gt;      Mean    SD   lCI Median   uCI error(MCMC) error(MCMC)/SD  ESS R-hat</span></span>
<span><span class="co">#&gt; mu  0.126 0.043 0.041  0.127 0.211     0.00044          0.010 9757 1.000</span></span>
<span><span class="co">#&gt; tau 0.292 0.033 0.233  0.290 0.364     0.00034          0.010 9678 1.000</span></span>
<span><span class="co">#&gt; The estimates are summarized on the Cohen's d scale (priors were specified on the Cohen's d scale).</span></span></code></pre></div>
<p>We verify that the effect size,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>μ</mi><mo>=</mo><mn>0.126</mn></mrow><annotation encoding="application/x-tex">\mu = 0.126</annotation></semantics></math>
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mtext mathvariant="normal">95% CI </mtext><mspace width="0.333em"></mspace></mrow><mrow><mo stretchy="true" form="prefix">[</mo><mn>0.041</mn><mo>,</mo><mn>0.211</mn><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">\text{95% CI } [0.041, 0.211]</annotation></semantics></math>),
and heterogeneity,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>τ</mi><mo>=</mo><mn>0.292</mn></mrow><annotation encoding="application/x-tex">\tau = 0.292</annotation></semantics></math>
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mtext mathvariant="normal">95% CI </mtext><mspace width="0.333em"></mspace></mrow><mrow><mo stretchy="true" form="prefix">[</mo><mn>0.233</mn><mo>,</mo><mn>0.364</mn><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">\text{95% CI } [0.233, 0.364]</annotation></semantics></math>),
estimates closely correspond to the frequentist results (as we would
expect from parameter estimates under weakly informative priors).</p>
</div>
<div class="section level4">
<h4 id="hierarchical-bayesian-random-effects-meta-analysis">Hierarchical Bayesian Random Effects Meta-Analysis<a class="anchor" aria-label="anchor" href="#hierarchical-bayesian-random-effects-meta-analysis"></a>
</h4>
<p>Second, we account for the clustered effect size estimates within
districts by extending the previous function call with the
<code>study_ids = dat$district</code> argument. This allows us to
estimate the hierarchical Bayesian random effects meta-analysis
(corresponding to <code>fit_metafor</code>). We use the default prior
distribution for the correlation parameter
<code>\rho \sim \text{Beta}(1, 1)</code>, set via the
<code>priors_hierarchical</code> argument, which restricts the
correlation to be positive and uniformly distributed on the interval
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(0, 1)</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/RoBMA.html">RoBMA</a></span><span class="op">(</span>d <span class="op">=</span> <span class="va">dat</span><span class="op">$</span><span class="va">yi</span>, v <span class="op">=</span> <span class="va">dat</span><span class="op">$</span><span class="va">vi</span>, study_ids <span class="op">=</span> <span class="va">dat</span><span class="op">$</span><span class="va">district</span>,</span>
<span>             priors_effect_null        <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>             priors_heterogeneity_null <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>             priors_bias               <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>             parallel <span class="op">=</span> <span class="cn">TRUE</span>, seed <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>Again, we generate the complete summary for the only estimated
model,</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span>, type <span class="op">=</span> <span class="st">"individual"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; RoBMA(d = dat$yi, v = dat$vi, study_ids = dat$district, priors_bias = NULL, </span></span>
<span><span class="co">#&gt;     priors_effect_null = NULL, priors_heterogeneity_null = NULL, </span></span>
<span><span class="co">#&gt;     parallel = TRUE, seed = 1)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Robust Bayesian meta-analysis                                                               </span></span>
<span><span class="co">#&gt;  Model              1             Parameter prior distributions</span></span>
<span><span class="co">#&gt;  Prior prob.    1.000                    mu ~ Normal(0, 1)     </span></span>
<span><span class="co">#&gt;  log(marglik)   25.70                   tau ~ InvGamma(1, 0.15)</span></span>
<span><span class="co">#&gt;  Post. prob.    1.000                   rho ~ Beta(1, 1)       </span></span>
<span><span class="co">#&gt;  Inclusion BF     Inf                                          </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Parameter estimates:</span></span>
<span><span class="co">#&gt;      Mean    SD   lCI Median   uCI error(MCMC) error(MCMC)/SD  ESS R-hat</span></span>
<span><span class="co">#&gt; mu  0.181 0.083 0.017  0.180 0.346     0.00088          0.011 9041 1.000</span></span>
<span><span class="co">#&gt; tau 0.308 0.056 0.223  0.299 0.442     0.00090          0.016 3859 1.000</span></span>
<span><span class="co">#&gt; rho 0.627 0.142 0.320  0.641 0.864     0.00219          0.015 4202 1.000</span></span>
<span><span class="co">#&gt; The estimates are summarized on the Cohen's d scale (priors were specified on the Cohen's d scale).</span></span></code></pre></div>
<p>and verify that our estimates, again, correspond to the frequentist
counterparts, with the estimated effect size,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>μ</mi><mo>=</mo><mn>0.181</mn></mrow><annotation encoding="application/x-tex">\mu = 0.181</annotation></semantics></math>
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mtext mathvariant="normal">95% CI </mtext><mspace width="0.333em"></mspace></mrow><mrow><mo stretchy="true" form="prefix">[</mo><mn>0.017</mn><mo>,</mo><mn>0.346</mn><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">\text{95% CI } [0.017, 0.346]</annotation></semantics></math>),
heterogeneity,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>τ</mi><mo>=</mo><mn>0.308</mn></mrow><annotation encoding="application/x-tex">\tau = 0.308</annotation></semantics></math>
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mtext mathvariant="normal">95% CI </mtext><mspace width="0.333em"></mspace></mrow><mrow><mo stretchy="true" form="prefix">[</mo><mn>0.223</mn><mo>,</mo><mn>0.442</mn><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">\text{95% CI } [0.223, 0.442]</annotation></semantics></math>),
and correlation,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ρ</mi><mo>=</mo><mn>0.627</mn></mrow><annotation encoding="application/x-tex">\rho = 0.627</annotation></semantics></math>
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mtext mathvariant="normal">95% CI </mtext><mspace width="0.333em"></mspace></mrow><mrow><mo stretchy="true" form="prefix">[</mo><mn>0.320</mn><mo>,</mo><mn>0.864</mn><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">\text{95% CI } [0.320, 0.864]</annotation></semantics></math>).</p>
<p>We can further visualize the prior and posterior distribution of the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ρ</mi><annotation encoding="application/x-tex">\rho</annotation></semantics></math>
parameter using the <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> function.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit</span>, parameter <span class="op">=</span> <span class="st">"rho"</span>, prior <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="HierarchicalBMA_files/figure-html/fig_rho-1.png" width="50%" style="display: block; margin: auto;"></p>
</div>
<div class="section level4">
<h4 id="hierarchical-bayesian-model-averaged-meta-analysis">Hierarchical Bayesian Model-Averaged Meta-Analysis<a class="anchor" aria-label="anchor" href="#hierarchical-bayesian-model-averaged-meta-analysis"></a>
</h4>
<p>Third, we extend the previous model into a model ensemble that also
includes models assuming the absence of the effect and/or heterogeneity
(we do not incorporate models assuming presence of publication bias due
to computational complexity explained in the summary). Including those
additional models allows us to evaluate evidence in favor of the effect
and heterogeneity. Furthermore, specifying all those additional models
allows us to incorporate the uncertainty about the specified models and
weight the posterior distribution according to how well the models
predicted the data. We estimate the remaining models by removing the
<code>priors_effect_null</code> and
<code>priors_heterogeneity_null</code> arguments from the previous
function calls, which include the previously omitted models of no effect
and/or no heterogeneity.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_BMA</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/RoBMA.html">RoBMA</a></span><span class="op">(</span>d <span class="op">=</span> <span class="va">dat</span><span class="op">$</span><span class="va">yi</span>, v <span class="op">=</span> <span class="va">dat</span><span class="op">$</span><span class="va">vi</span>, study_ids <span class="op">=</span> <span class="va">dat</span><span class="op">$</span><span class="va">district</span>,</span>
<span>                 priors_bias <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                 parallel <span class="op">=</span> <span class="cn">TRUE</span>, seed <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>Now we generate a summary for the complete model-averaged ensemble by
not specifying any additional arguments in the <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code>
function.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit_BMA</span><span class="op">)</span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; RoBMA(d = dat$yi, v = dat$vi, study_ids = dat$district, priors_bias = NULL, </span></span>
<span><span class="co">#&gt;     parallel = TRUE, seed = 1)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Robust Bayesian meta-analysis</span></span>
<span><span class="co">#&gt; Components summary:</span></span>
<span><span class="co">#&gt;               Models Prior prob. Post. prob. Inclusion BF</span></span>
<span><span class="co">#&gt; Effect           2/4       0.500       0.478 9.170000e-01</span></span>
<span><span class="co">#&gt; Heterogeneity    2/4       0.500       1.000 9.326943e+92</span></span>
<span><span class="co">#&gt; Hierarchical     2/4       0.500       1.000 9.326943e+92</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model-averaged estimates:</span></span>
<span><span class="co">#&gt;      Mean Median 0.025 0.975</span></span>
<span><span class="co">#&gt; mu  0.087  0.000 0.000 0.314</span></span>
<span><span class="co">#&gt; tau 0.326  0.317 0.231 0.472</span></span>
<span><span class="co">#&gt; rho 0.659  0.675 0.354 0.879</span></span>
<span><span class="co">#&gt; The estimates are summarized on the Cohen's d scale (priors were specified on the Cohen's d scale).</span></span></code></pre></div>
<p>We find the ensemble contains four models, the combination of models
assuming the presence/absence of the effect/heterogeneity, each with
equal prior model probabilities. Importantly, the models assuming
heterogeneity are also specified with the hierarchical structure and
account for the clustering. A comparison of the specified models reveals
weak evidence against the effect,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mtext mathvariant="normal">BF</mtext><mn>10</mn></msub><mo>=</mo><mn>0.917</mn></mrow><annotation encoding="application/x-tex">\text{BF}_{10} = 0.917</annotation></semantics></math>,
and extreme evidence for the presence of heterogeneity,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mtext mathvariant="normal">BF</mtext><mtext mathvariant="normal">rf</mtext></msub><mo>=</mo><mn>9.3</mn><mo>×</mo><msup><mn>10</mn><mn>92</mn></msup></mrow><annotation encoding="application/x-tex">\text{BF}_{\text{rf}} = 9.3\times10^{92}</annotation></semantics></math>.
Moreover, we find that the <code>Hierarchical</code> component summary
has the same values as the <code>Heterogeneity</code> component summary
because the default settings specify that all models assuming the
presence of heterogeneity also include the hierarchical structure.</p>
<p>We also obtain the model-averaged posterior estimates that combine
the posterior estimates from all models according to the posterior model
probabilities, the effect size,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>μ</mi><mo>=</mo><mn>0.087</mn></mrow><annotation encoding="application/x-tex">\mu = 0.087</annotation></semantics></math>
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mtext mathvariant="normal">95% CI </mtext><mspace width="0.333em"></mspace></mrow><mrow><mo stretchy="true" form="prefix">[</mo><mn>0.000</mn><mo>,</mo><mn>0.314</mn><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">\text{95% CI } [0.000, 0.314]</annotation></semantics></math>),
heterogeneity,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>τ</mi><mo>=</mo><mn>0.326</mn></mrow><annotation encoding="application/x-tex">\tau = 0.326</annotation></semantics></math>
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mtext mathvariant="normal">95% CI </mtext><mspace width="0.333em"></mspace></mrow><mrow><mo stretchy="true" form="prefix">[</mo><mn>0.231</mn><mo>,</mo><mn>0.472</mn><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">\text{95% CI } [0.231, 0.472]</annotation></semantics></math>),
and correlation,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ρ</mi><mo>=</mo><mn>0.659</mn></mrow><annotation encoding="application/x-tex">\rho = 0.659</annotation></semantics></math>
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mtext mathvariant="normal">95% CI </mtext><mspace width="0.333em"></mspace></mrow><mrow><mo stretchy="true" form="prefix">[</mo><mn>0.354</mn><mo>,</mo><mn>0.879</mn><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">\text{95% CI } [0.354, 0.879]</annotation></semantics></math>).</p>
</div>
<div class="section level4">
<h4 id="testing-the-presence-of-clustering">Testing the Presence of Clustering<a class="anchor" aria-label="anchor" href="#testing-the-presence-of-clustering"></a>
</h4>
<p>In the previous analyses, we assumed that the effect sizes are indeed
clustered within the districts, and we only adjusted for the clustering.
However, the effect sizes within the same cluster may not be more
similar than effect sizes from different clusters. Now, we specify a
model ensemble that allows us to test this assumption by specifying two
sets of random effect meta-analytic models. The first set of models
assumes that there is indeed clustering and that the correlation of
random effects is uniformly distributed on the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(0, 1)</annotation></semantics></math>
interval (as in the previous analyses). The second set of models assumes
that there is no clustering, i.e., the correlation of random effects
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ρ</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\rho = 0</annotation></semantics></math>,
which simplifies the structured covariance matrix to a diagonal matrix.
Again, we model average across models assuming the presence and absence
of the effect to account for the model uncertainty.</p>
<p>To specify this ‘special’ model ensemble with the
<code><a href="../reference/RoBMA.html">RoBMA()</a></code> function, we need to modify the previous model call
in the following ways. We removed the fixed effect models by specifying
the <code>priors_heterogeneity_null = NULL</code>
argument.<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>1</mn></msup><annotation encoding="application/x-tex">^1</annotation></semantics></math>
Furthermore, we specify the prior distribution for models assuming the
absence of the hierarchical structure by adding the
<code>priors_hierarchical_null = prior(distribution = "spike", parameters = list("location" = 0))</code>
argument.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hierarchical_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/RoBMA.html">RoBMA</a></span><span class="op">(</span>d <span class="op">=</span> <span class="va">dat</span><span class="op">$</span><span class="va">yi</span>, v <span class="op">=</span> <span class="va">dat</span><span class="op">$</span><span class="va">vi</span>, study_ids <span class="op">=</span> <span class="va">dat</span><span class="op">$</span><span class="va">district</span>,</span>
<span>                           priors_heterogeneity_null <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                           priors_hierarchical_null <span class="op">=</span> <span class="fu"><a href="../reference/prior.html">prior</a></span><span class="op">(</span>distribution <span class="op">=</span> <span class="st">"spike"</span>, parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"location"</span> <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                           priors_bias <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                           parallel <span class="op">=</span> <span class="cn">TRUE</span>, seed <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">hierarchical_test</span><span class="op">)</span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; RoBMA(d = dat$yi, v = dat$vi, study_ids = dat$district, priors_bias = NULL, </span></span>
<span><span class="co">#&gt;     priors_heterogeneity_null = NULL, priors_hierarchical_null = prior(distribution = "spike", </span></span>
<span><span class="co">#&gt;         parameters = list(location = 0)), parallel = TRUE, seed = 1)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Robust Bayesian meta-analysis</span></span>
<span><span class="co">#&gt; Components summary:</span></span>
<span><span class="co">#&gt;               Models Prior prob. Post. prob. Inclusion BF</span></span>
<span><span class="co">#&gt; Effect           2/4       0.500       0.478        0.917</span></span>
<span><span class="co">#&gt; Heterogeneity    4/4       1.000       1.000          Inf</span></span>
<span><span class="co">#&gt; Hierarchical     2/4       0.500       1.000     4624.794</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model-averaged estimates:</span></span>
<span><span class="co">#&gt;      Mean Median 0.025 0.975</span></span>
<span><span class="co">#&gt; mu  0.087  0.000 0.000 0.314</span></span>
<span><span class="co">#&gt; tau 0.326  0.317 0.231 0.472</span></span>
<span><span class="co">#&gt; rho 0.659  0.675 0.354 0.879</span></span>
<span><span class="co">#&gt; The estimates are summarized on the Cohen's d scale (priors were specified on the Cohen's d scale).</span></span></code></pre></div>
<p>We summarize the resulting model ensemble and find out that the
<code>Hierarchical</code> component is no longer equivalent to the
<code>Heterogeneity</code> component – the new model specification
allowed us to compare random effect models assuming the presence of the
hierarchical structure to random effect models assuming the absence of
the hierarchical structure. The resulting inclusion Bayes factor of the
hierarchical structure shows extreme evidence in favor of clustering of
the effect sizes,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mtext mathvariant="normal">BF</mtext><mrow><mi>ρ</mi><mover><mi>ρ</mi><mo accent="true">‾</mo></mover></mrow></msub><mo>=</mo><mn>4624</mn></mrow><annotation encoding="application/x-tex">\text{BF}_{\rho\bar{\rho}} = 4624</annotation></semantics></math>,
i.e., there is extreme evidence that the intervention results in more
similar effects within the districts.</p>
</div>
</div>
<div class="section level3">
<h3 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h3>
<p>We illustrated how to estimate a hierarchical Bayesian model-averaged
meta-analysis using the <code>RoBMA</code> package. The hBMA model
allows us to test for the presence vs absence of the effect and
heterogeneity while simultaneously adjusting for clustered effect size
estimates. While the current implementation allows us to draw a fully
Bayesian inference, incorporate prior information, and acknowledge model
uncertainty, it has a few limitations in contrast to the
<code>metafor</code> package. E.g., the <code>RoBMA</code> package only
allows a simple nested random effects (i.e., estimates within studies,
schools within districts etc). The simple nesting allows us to break the
full covariance matrix into per cluster block matrices which speeds up
the already demanding computation. Furthermore, the computational
complexity significantly increases when considering selection models as
we need to compute an exponentially increasing number of multivariate
normal probabilities with the increasing cluster size (existence of
clusters with more than four studies makes the current implementation
impractical due to the computational demands). However, these current
limitations are not the end of the road, as we are exploring other
approaches (e.g., only specifying PET-PEESE style publication bias
adjustment and other dependency adjustments) in a future vignette.</p>
</div>
<div class="section level3">
<h3 id="footnotes">Footnotes<a class="anchor" aria-label="anchor" href="#footnotes"></a>
</h3>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>1</mn></msup><annotation encoding="application/x-tex">^1</annotation></semantics></math>
We could also model-average across the hierarchical structure assuming
fixed effect models, i.e.,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>τ</mi><mo>∼</mo><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>.</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\tau \sim f(.)</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ρ</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\rho = 1</annotation></semantics></math>.
However specifying such a model ensemble is a beyond the scope of this
vignette, see <a href="CustomEnsembles.html">Custom ensembles</a>
vignette for some hints.</p>
</div>
<div class="section level3 unnumbered">
<h3 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h3>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0" line-spacing="2">
<div id="ref-bartos2021bayesian" class="csl-entry">
Bartoš, F., Gronau, Q. F., Timmers, B., Otte, W. M., Ly, A., &amp;
Wagenmakers, E.-J. (2021). Bayesian model-averaged meta-analysis in
medicine. <em>Statistics in Medicine</em>, <em>40</em>(30), 6743–6761.
<a href="https://doi.org/10.1002/sim.9170" class="external-link">https://doi.org/10.1002/sim.9170</a>
</div>
<div id="ref-gronau2020primer" class="csl-entry">
Gronau, Q. F., Heck, D. W., Berkhout, S. W., Haaf, J. M., &amp;
Wagenmakers, E.-J. (2021). A primer on <span>B</span>ayesian
model-averaged meta-analysis. <em>Advances in Methods and Practices in
Psychological Science</em>, <em>4</em>(3), 1–19. <a href="https://doi.org/10.1177/25152459211031256" class="external-link">https://doi.org/10.1177/25152459211031256</a>
</div>
<div id="ref-gronau2017bayesian" class="csl-entry">
Gronau, Q. F., Van Erp, S., Heck, D. W., Cesario, J., Jonas, K. J.,
&amp; Wagenmakers, E.-J. (2017). A <span>B</span>ayesian model-averaged
meta-analysis of the power pose effect with informed and default priors:
<span>T</span>he case of felt power. <em>Comprehensive Results in Social
Psychology</em>, <em>2</em>(1), 123–138. <a href="https://doi.org/10.1080/23743603.2017.1326760" class="external-link">https://doi.org/10.1080/23743603.2017.1326760</a>
</div>
<div id="ref-konstantopoulos2011fixed" class="csl-entry">
Konstantopoulos, S. (2011). Fixed effects and variance components
estimation in three-level meta-analysis. <em>Research Synthesis
Methods</em>, <em>2</em>(1), 61–76. <a href="https://doi.org/10.1002/jrsm.35" class="external-link">https://doi.org/10.1002/jrsm.35</a>
</div>
<div id="ref-metadat" class="csl-entry">
Thomas, W., Daniel, N., Alistair, S., W. Kyle, H., &amp; Wolfgang, V.
(2019). <em><span class="nocase">m</span>etadat:
<span>M</span>eta-analysis datasets</em>. <a href="https://cran.r-project.org/package=metadat" class="external-link">https://cran.r-project.org/package=metadat</a>
</div>
<div id="ref-metafor" class="csl-entry">
Wolfgang, V. (2010). Conducting meta-analyses in <span>R</span> with the
<span class="nocase">metafor</span> package. <em>Journal of Statistical
Software</em>, <em>36</em>(3), 1–48. <a href="https://www.jstatsoft.org/v36/i03/" class="external-link">https://www.jstatsoft.org/v36/i03/</a>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by František Bartoš, Maximilian Maier.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
